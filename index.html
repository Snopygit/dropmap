<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Fortnite Dropmap</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #1a1a1a;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
    }
    #info {
      margin-bottom: 10px;
      background: #333;
      padding: 8px 16px;
      border-radius: 8px;
    }
    canvas {
      border: 2px solid #555;
      border-radius: 8px;
      background: #000;
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <div id="info">Klicke: Startpunkt → Endpunkt → Zielpunkt</div>
  <canvas id="mapCanvas" width="900" height="900"></canvas>

  <script>
    const canvas = document.getElementById('mapCanvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = 'fortnite-dropmap/assets/map.png'; // Dein Bildpfad

    const points = [];

    img.onload = () => {
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    };

    canvas.addEventListener('click', e => {
      if (points.length >= 3) points.length = 0;
      const rect = canvas.getBoundingClientRect();
      points.push({
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      });
      redraw();
    });

    function drawIcon(x, y, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    function redraw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      if (points.length >= 1) drawIcon(points[0].x, points[0].y, 'yellow');
      if (points.length >= 2) {
        drawIcon(points[1].x, points[1].y, 'orange');
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(points[0].x, points[0].y);
        ctx.lineTo(points[1].x, points[1].y);
        ctx.stroke();
      }
      if (points.length >= 3) {
        drawIcon(points[2].x, points[2].y, 'white');
        const drop = calculateDropPoint(points[0], points[1], points[2]);
        if (drop) {
          drawIcon(drop.x, drop.y, 'cyan');

          // Gleiteröffnungspunkt berechnen (z. B. 1000 Pixel vorher entlang der Route)
          const glideDistance = 100; // Annehmbarer Gleiteröffnungsabstand in px
          const dx = drop.x - points[2].x;
          const dy = drop.y - points[2].y;
          const len = Math.sqrt(dx * dx + dy * dy);
          if (len > 0) {
            const gx = points[2].x + (dx / len) * glideDistance;
            const gy = points[2].y + (dy / len) * glideDistance;
            drawIcon(gx, gy, 'lime'); // Punkt wo Gleiter aufgeht
          }
        }
      }
    }

    function calculateDropPoint(start, end, target) {
      const dx = end.x - start.x;
      const dy = end.y - start.y;
      const lengthSq = dx * dx + dy * dy;
      if (lengthSq === 0) return null;
      const t = ((target.x - start.x) * dx + (target.y - start.y) * dy) / lengthSq;
      const tClamped = Math.max(0, Math.min(1, t));
      return {
        x: start.x + tClamped * dx,
        y: start.y + tClamped * dy
      };
    }
  </script>
</body>
</html>
