<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Dropmap bearbeiten</title>
  <style>
    body { margin: 0; background: #111; color: white; font-family: sans-serif; overflow: hidden; }
    body.no-scroll { overflow: hidden; }

    /* Home-Link */
    .home {
      position: fixed; top: 10px; left: 10px;
      display: flex; align-items: center; gap: 10px; z-index: 1000;
    }
    .home img { width: 32px; height: 32px; border-radius: 4px; }
    .home h1 { margin: 0; font-size: 24px; color: white; }

    /* User‚ÄëPanel */
    .user-panel {
      position: fixed; top: 10px; right: 10px;
      display: none; align-items: center; gap: 8px;
      background: #222; padding: 8px 12px; border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.5); z-index: 1000;
    }
    .user-panel img { width: 32px; height: 32px; border-radius: 50%; }
    .user-panel .name { color: white; font-weight: bold; cursor: pointer; position: relative; }
    .logout-menu { position: absolute; top: 110%; right: 0; background: #222; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.5); display: none; opacity: 0; transition: opacity 0.3s ease; }
    .logout-menu button { background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .user-panel:hover .logout-menu,
    .logout-menu:hover { display: block; opacity: 1; }

    h2 { margin: 60px 0 10px; }

    .controls button { background: #007bff; border: none; color: white; padding: 10px 20px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-bottom: 10px; }

    #mapContainer { position: relative; }
    canvas { border: 2px solid #333; border-radius: 10px; cursor: grab; display: block; }

    /* Not‚Äëwhitelisted Popup */
    #overlayPopup { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); display: none; z-index: 2000; }
    #notWhitePopup {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
      background: #2C2F33; padding: 30px 20px; border-radius: 12px;
      box-shadow: 0 0 20px 5px #7289DA; display: none;
      flex-direction: column; align-items: center;
      z-index: 2001; opacity: 0; transition: opacity 0.3s ease;
    }
    #notWhitePopup p { margin: 0 0 20px; font-size: 18px; font-weight: bold; text-align: center; }
    #notWhitePopup button { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>
  <div class="home">
    <a href="index.html">
      <img src="fortnite-dropmap/assets/dropmap.png" alt="Dropmap">
      <h1>Home</h1>
    </a>
  </div>

  <!-- Discord‚ÄëPanel -->
  <div class="user-panel" id="userPanel">
    <img id="userAvatar" src="" alt="Avatar">
    <div class="name" id="userName"></div>
    <div class="logout-menu" id="logoutMenu">
      <button onclick="logout()">üö™¬†Logout</button>
    </div>
  </div>

  <h2>Dropmap bearbeiten</h2>
  <button class="controls" onclick="showPopup()">üíæ¬†Dropmap speichern</button>
  <div id="mapContainer">
    <canvas id="mapCanvas" width="900" height="900"></canvas>
    <div class="context-menu" id="contextMenu">
      <button onclick="enableEdit()">‚úèÔ∏è¬†Bearbeiten</button>
      <button onclick="deleteMarker()">üóëÔ∏è¬†L√∂schen</button>
    </div>
    <div class="side-controls">
      <button id="markerIcon" class="icon-button" draggable="true">üìç</button>
      <button class="icon-button" onclick="undo()">‚Ü©Ô∏è</button>
      <button class="icon-button" onclick="redo()">‚Ü™Ô∏è</button>
    </div>
  </div>

  <div id="overlayPopup"></div>
  <div id="notWhitePopup">
    <p>Du bist nicht whitelisted!</p>
    <button onclick="logout()">Log mich aus</button>
  </div>

  <div class="overlay" id="overlay" onclick="hidePopup(event)"></div>
  <div class="popup" id="popup">
    <button class="close-btn" onclick="closePopup()">‚úñ</button>
    <label for="dropmapName">Name der Dropmap:</label>
    <input type="text" id="dropmapName" placeholder="z.B. Meine Dropmap">
    <button class="save-button" onclick="saveDropmapName()">Speichern</button>
  </div>

  <script>
    // Whitelist IDs
    const WHITELIST = ['1221451449695735884','644602114256928789','868581285277347920'];

    async function fetchUser() {
      const token = localStorage.getItem('discord_token');
      if (!token) return;
      try {
        const res = await fetch('https://discord.com/api/users/@me', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!res.ok) throw new Error();
        const user = await res.json();
        if (!WHITELIST.includes(user.id)) {
          document.body.classList.add('no-scroll');
          document.getElementById('overlayPopup').style.display = 'block';
          const pop = document.getElementById('notWhitePopup');
          pop.style.display = 'flex';
          requestAnimationFrame(() => pop.style.opacity = '1');
          return;
        }
        document.getElementById('userAvatar').src =
          `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=64`;
        document.getElementById('userName').textContent =
          `${user.username}#${user.discriminator}`;
        document.getElementById('userPanel').style.display = 'flex';
      } catch {
        localStorage.removeItem('discord_token');
      }
    }
    function logout() {
      localStorage.removeItem('discord_token');
      window.location = 'index.html';
    }
    window.addEventListener('load', fetchUser);

    // ... der bestehende Editor‚ÄëCode bleibt unver√§ndert hier ...
  </script>
</body>
</html>
